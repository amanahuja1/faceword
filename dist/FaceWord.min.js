/*! FaceWord - v0.0.3 - 2015-08-09
* Copyright (c) 2015 Rama Dimasatria; Licensed  */
FaceWord=function(){"use strict";function a(a,b,c,d){var f;return f=new Promise(function(f,g){window.setTimeout(function(){try{e(a,b,c,d),k()}catch(h){g(h.message)}f()},1)})}function b(){return s}function c(){s.clearRect(0,0,q.width,q.height)}function d(){return t}function e(a,b,c,d){for(var e in d)d.hasOwnProperty(e)&&(t[e]=d[e]);p=h(a),r=i(b),q=j(c),s=q.getContext("2d"),FaceWord.ImageProcessor.init(),FaceWord.BlockManager.init(),FaceWord.WordManager.init(b)}function f(a){return a instanceof HTMLImageElement&&a.src}function g(a){return a instanceof HTMLCanvasElement}function h(a){var b=new Image;if(f(a))b.src=a.src;else{if(!g(a))throw new Error("Invalid image");b.src=a.toDataURL()}return b.width=Math.min(a.width,t.imgMaxWidth),b.height=a.height,b}function i(a){if(!a||"string"!=typeof a)throw new Error("Invalid text");return a}function j(a){var b=document.querySelector(a);if(!(b&&b instanceof HTMLCanvasElement))throw new Error("Invalid canvas selector");return b.width=p.width,b.height=p.height,b}function k(){var a,b,d,e,f,g;a=FaceWord.ImageProcessor.process(p),b=FaceWord.ImageProcessor.encode(a),c();for(var h=0;h<b.valueMap.length-1;h++)for(g=b.valueMap[h],d=FaceWord.BlockManager.weighMatrix(b.data,h),f=!0;f;)e=FaceWord.BlockManager.getBlock(d),e?(l(e,g),FaceWord.BlockManager.normalize(d,e)):f=!1}function l(a,b){var c,d,e,f=m(a),g=FaceWord.WordManager.getWord(),h=f.x,i=f.y,j=f.width,k=f.height,l=n(g,j,k);l&&(c=l[0],d=l[1],e=Math.ceil(.8*c),s.font=c+"px "+t.fontFamily,s.textBaseline="hanging",s.fillStyle="rgb("+b+","+b+","+b+")",s.fillText(g,h,i,j),s.restore(),o(a,d,e))}function m(a){var b=t.blockSize;return{x:a.x*b,y:a.y*b,width:a.width*b,height:a.height*b}}function n(a,b,c){var d,e,f,g=t.minFontSize;if(s.font=g+"px serif",e=s.measureText(a).width,d=b-e,0>d)return!1;for(;d>0&&c>g&&g<t.maxFontSize;)f=e,g+=1,s.font=g+"px serif",e=s.measureText(a).width,d=b-e;return[g-1,f]}function o(a,b,c){a.renderedWidth=Math.ceil(b/t.blockSize),a.renderedHeight=Math.ceil(c/t.blockSize)}var p,q,r,s,t={contrast:0,blockSize:5,minFontSize:2,maxFontSize:48,imgMaxWidth:600,fontFamily:"serif",colors:8,inverse:!1,orientation:"mixed"};return{getCanvasContext:b,clearCanvas:c,getSettings:d,run:a}}(),FaceWord.BlockManager=function(a){function b(){g=a.getSettings()}function c(a,b){var c,d,e,f,g=a.length,h=a[0].length,i=[];for(f=0;g>f;f++)for(d=0,i[f]=[],e=h-1;e>=0;e--)c=a[f][e],c===b?d++:d=0,i[f][e]=[d];for(e=0;h>e;e++)for(d=0,f=g-1;f>=0;f--)c=a[f][e],c===b?d++:d=0,i[f][e][1]=d;return i}function d(a){var b,c,d,e,g,h,i,j=f(a),k={};if(!j)return!1;b=j.x,c=j.y,d=0,e=j.rowWeight,g=j.colWeight;for(var l=0;e>l;l++){var m,n=a[c+l][b];if(h=Math.min(g,n[0]),i=l+1,m=h*i,!(m>=d)){i=l,h=g;break}d=m,g=h}return k={x:b,y:c,width:h,height:i}}function e(a,b){if(b.renderedWidth&&b.renderedHeight){var c,d,e,f,g=b.renderedHeight,h=b.renderedWidth;for(d=b.y;d<b.y+g;d++)for(c=b.x;c<b.x+h;c++)a[d][c]=[0,0];for(d=b.y;d<g+b.y;d++)for(f=0,c=b.x-1;c>=0&&(e=a[d][c],0!==e[0]||0!==e[1]);c--)f++,e[0]=f;for(c=b.x;c<h+b.x;c++)for(f=0,d=b.y-1;d>=0&&(e=a[d][c],0!==e[0]||0!==e[1]);d--)f++,e[1]=f}}function f(a){for(var b,c=0,d={},e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)b=a[e][f][0]*a[e][f][1],b>c&&(c=b,d={x:f,y:e,colWeight:a[e][f][0],rowWeight:a[e][f][1]});return 0===c?!1:d}var g;return{init:b,weighMatrix:c,getBlock:d,normalize:e}}(FaceWord||{}),FaceWord.ImageProcessor=function(a){function b(){k={},l=a.getCanvasContext(),m=a.getSettings()}function c(a){var b,c,d,f,h,i,j=m.contrast,n=259*(j+255)/(255*(259-j));e(a),b=l.getImageData(0,0,k.width,k.height),c=b.data;for(var o=0;o<c.length;o+=4)d=c[o],f=c[o+1],h=c[o+2],i=(d+f+h)/3,i=g(n*(i-128)+128),i=i>120?255:0,c[o]=i,c[o+1]=i,c[o+2]=i;return b}function d(a){var b,c,d,e,g,h,l,n,o,p,q=a.data,r=[],s=m.blockSize;for(p=i(),c=0;c<k.height;c+=s)for(h=c/s,r[h]=[],e=c+s-1,e>k.height&&(e=k.height-1),b=0;b<k.width;b+=s)l=b/s,d=b+s-1,d>k.width&&(d=k.width-1),n=f(q,b,c,d,e),n=j(n,p),o=p.indexOf(n),r[h][l]=o;return g={data:r,valueMap:p}}function e(a){k.el=a,k.width=a.width,k.height=a.height,l.drawImage(k.el,0,0,k.width,k.height)}function f(a,b,c,d,e){for(var f,g,i=0,j=0,l=c;e>l;l++)for(var n=b;d>n;n++)f=a[4*(k.width*l+n)],i+=f,j++;return g=Math.floor(i/j),m.inverse&&(g=h(g)),g}function g(a){return 0>a?0:a>255?255:a}function h(a){return 255-a}function i(){for(var a=m.colors,b=[],c=a;c>=0;c--)b[c]=Math.floor(255*(c/a));return b}function j(a,b){var c,d;c=Math.floor((b[1]-b[0])/2);for(var e=0;e<b.length;e++)if(Math.abs(a-b[e])<c){d=b[e];break}return d}var k,l,m;return{init:b,process:c,encode:d}}(FaceWord||{}),FaceWord.WordManager=function(){function a(a){e=c(a),d=0}function b(){var a=d-e.length*Math.floor(d/e.length),b=e[a].word;return d++,b.toUpperCase()}function c(a){var b=[],c=a.match(/[A-z]+/g),d=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","don","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your","ain't","aren't","can't","could've","couldn't","didn't","doesn't","don't","hasn't","he'd","he'll","he's","how'd","how'll","how's","i'd","i'll","i'm","i've","isn't","it's","might've","mightn't","must've","mustn't","shan't","she'd","she'll","she's","should've","shouldn't","that'll","that's","there's","they'd","they'll","they're","they've","wasn't","we'd","we'll","we're","weren't","what'd","what's","when'd","when'll","when's","where'd","where'll","where's","who'd","who'll","who's","why'd","why'll","why's","won't","would've","wouldn't","you'd","you'll","you're","you've","very"];if(c.forEach(function(a){if(a=a.toLowerCase(),-1===d.indexOf(a)){for(var c=!1,e=0;e<b.length;e++)if(b[e].word===a){b[e].occurence++,c=!0;break}c||b.push({word:a,occurence:1})}}),b.sort(function(a,b){return b.occurence-a.occurence}),0===b.length)throw new Error("Cannot parse text");return b}var d,e=[];return{init:a,getWord:b}}(FaceWord||{});