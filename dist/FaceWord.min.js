/*! FaceWord - v0.0.1 - 2015-07-30
* Copyright (c) 2015 Rama Dimasatria; Licensed  */
FaceWord=function(){function a(a,b,c,d){for(var e in d)d.hasOwnProperty(e)&&(o[e]=d[e]);l=g(a),f(c),FaceWord.ImageProcessor.init(l),FaceWord.BlockManager.init(),FaceWord.WordManager.init(b)}function b(){return n}function c(){n.clearRect(0,0,m.width,m.height)}function d(){return o}function e(){var a,b,d,e=FaceWord.ImageProcessor.process(l),f=FaceWord.ImageProcessor.encode(e);c();for(var g=1;g<f.valueMap.length;g++)for(a=FaceWord.BlockManager.weighMatrix(f.data,g),d=!0;d;)b=FaceWord.BlockManager.getBlock(a),b?(h(b),FaceWord.BlockManager.normalize(a,b)):d=!1}function f(a){m=document.querySelector(a),m.width=l.width,m.height=l.height,n=m.getContext("2d")}function g(a){return a.width=Math.min(a.width,o.maxImageSize),a.height=Math.min(a.height,o.maxImageSize),a}function h(a){var b,c,d,e=i(a),f=FaceWord.WordManager.getWord(),g=e.x,h=e.y,l=e.width,m=e.height,o=j(f,l,m);o&&(b=o[0],c=o[1],d=Math.ceil(.8*b),n.font=b+"px serif",n.fillText(f,g,h+d,l),k(a,c,d))}function i(a){var b=o.blockSize;return{x:a.x*b,y:a.y*b,width:a.width*b,height:a.height*b}}function j(a,b,c){var d,e,f,g=o.minFontSize;if(n.font=g+"px serif",e=n.measureText(a).width,d=b-e,0>d)return!1;for(;d>0&&c>g;)f=e,g+=1,n.font=g+"px serif",e=n.measureText(a).width,d=b-e;return[g-1,f]}function k(a,b,c){a.renderedWidth=Math.ceil(b/o.blockSize),a.renderedHeight=Math.ceil(c/o.blockSize)}var l,m,n,o={contrast:-10,blockSize:5,minFontSize:2,minHeight:5,minWidth:5,maxImageSize:600,blockMinWidth:3};return{init:a,getCanvasContext:b,clearCanvas:c,getSettings:d,run:e}}(),FaceWord.BlockManager=function(a){function b(){g=a.getSettings()}function c(a,b){var c,d,e,f,g=a.length,h=a[0].length,i=[];for(f=0;g>f;f++)for(d=0,i[f]=[],e=h-1;e>=0;e--)c=a[f][e],c===b?d++:d=0,i[f][e]=[d];for(e=0;h>e;e++)for(d=0,f=g-1;f>=0;f--)c=a[f][e],c===b?d++:d=0,i[f][e][1]=d;return i}function d(a){var b,c,d,e,g,h,i,j=f(a),k={};if(!j)return!1;b=j.x,c=j.y,d=0,e=Math.min(j.rowWeight,Math.ceil(.5*j.colWeight)),g=j.colWeight;for(var l=0;e>l;l++){var m,n=a[c+l][b];if(h=Math.min(g,n[0]),i=l+1,m=h*i,!(m>=d)){i=l,h=g;break}d=m,g=h}return k={x:b,y:c,width:h,height:i}}function e(a,b){if(b.renderedWidth&&b.renderedHeight){var c,d,e,f,g=b.renderedHeight,h=b.renderedWidth;for(d=b.y;d<b.y+g;d++)for(c=b.x;c<b.x+h;c++)a[d][c]=[0,0];for(d=b.y;d<g+b.y;d++)for(f=0,c=b.x-1;c>=0&&(e=a[d][c],0!==e[0]||0!==e[1]);c--)f++,e[0]=f;for(c=b.x;c<h+b.x;c++)for(f=0,d=b.y-1;d>=0&&(e=a[d][c],0!==e[0]||0!==e[1]);d--)f++,e[1]=f}}function f(a){for(var b,c=0,d={},e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)b=a[e][f][0]*a[e][f][1],b>c&&(c=b,d={x:f,y:e,colWeight:a[e][f][0],rowWeight:a[e][f][1]});return 0===c?!1:d}var g;return{init:b,weighMatrix:c,getBlock:d,normalize:e}}(FaceWord||{}),FaceWord.ImageProcessor=function(a){function b(){i={},j=a.getCanvasContext(),k=a.getSettings()}function c(a){var b,c,d,f,g,l,m=k.contrast,n=259*(m+255)/(255*(259-m));e(a),b=j.getImageData(0,0,i.width,i.height),c=b.data;for(var o=0;o<c.length;o+=4)d=c[o],f=c[o+1],g=c[o+2],l=(d+f+g)/3,l=h(n*(l-128)+128),l=l>120?255:0,c[o]=l,c[o+1]=l,c[o+2]=l;return b}function d(a){for(var b,c=f(a),d=[],e=[],g=0;g<c.length;g++){e[g]=[];for(var h=0;h<c[g].length;h++){var i=d.indexOf(c[g][h]);-1===i?(d.push(c[g][h]),e[g][h]=d.length-1):e[g][h]=i}}return b={data:e,valueMap:d}}function e(a){i.el=a,i.width=a.width,i.height=a.height,j.drawImage(i.el,0,0,i.width,i.height)}function f(a){var b,c,d,e,f,h,j,l=a.data,m=[],n=k.blockSize;for(c=0;c<i.height;c+=n)for(f=c/n,m[f]=[],e=c+n-1,e>i.height&&(e=i.height-1),b=0;b<i.width;b+=n)h=b/n,d=b+n-1,d>i.width&&(d=i.width-1),j=g(l,b,c,d,e),m[f][h]=j;return m}function g(a,b,c,d,e){for(var f,g,h=0,j=0,k=c;e>k;k++)for(var l=b;d>l;l++)f=a[4*(i.width*k+l)],h+=f,j++;return g=Math.floor(h/j),g>200?255:0}function h(a){return 0>a?0:a>255?255:a}var i,j,k;return{init:b,process:c,encode:d}}(FaceWord||{}),FaceWord.WordManager=function(){function a(a){e=[],d=0,c(a)}function b(){var a=d-e.length*Math.floor(d/e.length),b=e[a].word;return d++,b.toUpperCase()}function c(a){var b=a.match(/[A-z]+/g),c=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your","ain't","aren't","can't","could've","couldn't","didn't","doesn't","don't","hasn't","he'd","he'll","he's","how'd","how'll","how's","i'd","i'll","i'm","i've","isn't","it's","might've","mightn't","must've","mustn't","shan't","she'd","she'll","she's","should've","shouldn't","that'll","that's","there's","they'd","they'll","they're","they've","wasn't","we'd","we'll","we're","weren't","what'd","what's","when'd","when'll","when's","where'd","where'll","where's","who'd","who'll","who's","why'd","why'll","why's","won't","would've","wouldn't","you'd","you'll","you're","you've"];b.forEach(function(a){if(a=a.toLowerCase(),-1===c.indexOf(a)){for(var b=!1,d=0;d<e.length;d++)if(e[d].word===a){e[d].occurence++,b=!0;break}b||e.push({word:a,occurence:1})}}),e.sort(function(a,b){return b.occurence-a.occurence})}var d,e=[];return{init:a,getWord:b}}(FaceWord||{});